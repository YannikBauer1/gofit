import{u as _,G as P,r as c,e as M,L as I,c as t,a as s,g as R,M as u,t as y,O as j,h,P as x,N as q,o}from"./BI50-cdB.js";import{_ as C}from"./CDpEqQqG.js";import{c as E}from"./jDoFrVe_.js";const U={class:"min-h-screen bg-gray-50 flex items-center justify-center"},A={class:"max-w-md w-full bg-white rounded-lg shadow-md p-8"},B={class:"text-center"},N={key:0,class:"mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-blue-100 mb-6"},S={key:1,class:"mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-green-100 mb-6"},V={key:2,class:"mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-red-100 mb-6"},L={class:"text-xl font-semibold text-gray-800 mb-3"},Y={class:"text-gray-600 mb-6"},D={key:3,class:"mb-6"},K=["disabled"],O={key:4,class:"mb-6"},T={key:5,class:"mb-6"},G={key:6,class:"mb-6"},H={class:"text-sm text-red-600"},W={__name:"reset-password",setup(z){_({title:"Reset Password - IronInsights"});const w=P();if(!w.public.supabaseApiUrl||!w.public.supabaseApiKey)throw new Error("Supabase environment variables are not configured. Please check your .env file.");const b=E(w.public.supabaseApiUrl,w.public.supabaseApiKey),f=I();q();const r=c("nothing"),a=c("Enter your new password below"),i=c(""),n=c(""),p=c(""),m=c(!1);M(async()=>{const d=f.query.token_hash,e=f.query.type;if(!d||!e){r.value="error",a.value="Invalid reset link",i.value="Missing reset token or type. Please check your email for the correct link.";return}r.value="nothing",a.value="Enter your new password below"});async function k(){if(n.value!==p.value){i.value="Passwords do not match";return}if(n.value.length<8){i.value="Password must be at least 8 characters long";return}const d=f.query.token_hash,e=f.query.type;if(!d||!e){r.value="error",a.value="Invalid reset link",i.value="Missing reset token or type.";return}m.value=!0,a.value="Updating your password...";try{console.log("Attempting password reset with token_hash:",d,"and type:",e);const{data:l,error:g}=await b.auth.verifyOtp({type:e,token_hash:d});if(g)throw g;console.log("Token verified successfully, updating password...");const{error:v}=await b.auth.updateUser({password:n.value});if(v)throw console.error("Password update error:",v),v;r.value="success",a.value="Your password has been successfully reset!"}catch(l){console.error("Password reset error:",l),r.value="error",a.value="Password reset failed",i.value=l.message||"An error occurred while resetting your password. Please try again."}finally{m.value=!1}}return(d,e)=>(o(),t("div",U,[s("div",A,[s("div",B,[e[10]||(e[10]=R('<div class="flex justify-center mb-4"><div class="rounded-xl flex items-center justify-center shadow-lg"><img src="'+C+'" alt="Iron Insights Logo" class="w-16 h-16 rounded-lg"></div></div><h1 class="text-3xl font-bold text-gray-900 mb-2">Iron Insights</h1><p class="text-sm text-gray-500 mb-8">Reset Password</p>',3)),r.value==="loading"?(o(),t("div",N,e[2]||(e[2]=[s("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"},null,-1)]))):u("",!0),r.value==="success"?(o(),t("div",S,e[3]||(e[3]=[s("svg",{class:"h-8 w-8 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1)]))):u("",!0),r.value==="error"?(o(),t("div",V,e[4]||(e[4]=[s("svg",{class:"h-8 w-8 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))):u("",!0),s("h2",L,y(r.value==="success"?"Password Reset!":r.value==="error"?"Something went wrong":"Reset Your Password"),1),s("p",Y,y(a.value),1),m.value?u("",!0):(o(),t("div",D,[s("form",{onSubmit:j(k,["prevent"]),class:"space-y-4"},[s("div",null,[e[5]||(e[5]=s("label",{for:"password",class:"block text-sm font-medium text-gray-700 mb-2"},"New Password",-1)),h(s("input",{id:"password","onUpdate:modelValue":e[0]||(e[0]=l=>n.value=l),type:"password",required:"",minlength:"8",class:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter your new password"},null,512),[[x,n.value]])]),s("div",null,[e[6]||(e[6]=s("label",{for:"confirmPassword",class:"block text-sm font-medium text-gray-700 mb-2"},"Confirm Password",-1)),h(s("input",{id:"confirmPassword","onUpdate:modelValue":e[1]||(e[1]=l=>p.value=l),type:"password",required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Confirm your new password"},null,512),[[x,p.value]])]),s("button",{type:"submit",disabled:!n.value||!p.value||n.value!==p.value,class:"w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"}," Reset Password ",8,K)],32)])),r.value==="loading"&&m.value?(o(),t("div",O,e[7]||(e[7]=[s("p",{class:"text-sm text-gray-500"},"Updating your password...",-1)]))):u("",!0),r.value==="success"?(o(),t("div",T,e[8]||(e[8]=[s("p",{class:"text-sm text-green-600"}," Your password has been successfully reset. You can now sign in with your new password. ",-1)]))):u("",!0),r.value==="error"?(o(),t("div",G,[s("p",H,y(i.value),1),e[9]||(e[9]=s("p",{class:"text-xs text-gray-500 mt-2"}," If you continue to have issues, please try requesting a new password reset link. ",-1))])):u("",!0)])])]))}};export{W as default};
